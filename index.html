<!DOCTYPE html>
<html>
<head>
    <title>Mockup Endeavor Web App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
    <link rel="stylesheet" href="jquery/jquery.mobile-1.2.0.min.css"/>
    <script src="jquery/jquery-1.8.2.min.js"></script>
    <script src="jquery/jquery.mobile-1.2.0.min.js"></script>
    <script src="cordova-2.0.0.js"></script>
    
    <!-- goole map stuff -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="jquery-ui-map/jquery.ui.map.js"></script>
    
    <!-- jTweetsAnywhere plugin -->
    <script type="text/javascript" src="jtweetsanywhere/jquery.jtweetsanywhere-1.3.1.min.js"></script>
    <script type="text/javascript" src="jtweetsanywhere/jtweetsanywhere-de-1.3.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="jtweetsanywhere/jquery.jtweetsanywhere-1.3.1.css" />
        
    <script type="text/javascript">
    
    	var soapMessageC = '<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> \
<SOAP-ENV:Body> \
<Execute xmlns="EX2012"> \
</Execute> \
</SOAP-ENV:Body> \
</SOAP-ENV:Envelope >';
    
    	function onLoad(){
    		document.addEventListener("deviceready", onDeviceReady, false);
    		//banderas para saber si la aplicacion paso a background
    		localStorage.setItem("resumeSponsors", "1");
    		localStorage.setItem("resumeAgenda", "1");
    		localStorage.setItem("resumeSpeakers", "1");
    	}
    	
    	//Cordoba esta cargado y ahora se puede llamar a todos su metodo sin problemas
    	function onDeviceReady(){
    		document.addEventListener("resume", onResume, false);
    	}
    	
    	function onResume(){
    		localStorage.setItem("resumeSponsors", "1");
    		localStorage.setItem("resumeAgenda", "1");
    		localStorage.setItem("resumeSpeakers", "1");
    	}
    	
    	function traerSponsors(){
			$.ajax({
				url: 'http://buhoonline.com/ex2012/servlet/awssponsors',
				type: "POST",
				datatype: 'xml',
				data: soapMessageC,
				complete: guardarSponsors,
				failure: onSponsorsError
			});
    	}
			
		function onSponsorsError(error){
			var data = window.localStorage.getItem('sponsors');
			if(data != null)
				llenarSponsors($.parseJSON(data));
			else{
				$.getJSON("json/sponsors.json", 
					function(data){
						llenarSponsors(data)
					}
				);
			}
		}
		
		function guardarSponsors(data){
			var sponsors = $(data.responseText).text();
			window.localStorage.setItem('sponsors', sponsors);
        	llenarSponsors($.parseJSON(sponsors));
		}
		
		//Llena la lista de sponsors a traves de un json como parametro
		function llenarSponsors(data){
        	var $page = $("#Sponsors");
        	$page.find(".content").empty();
        	$page.find(".content").html("<ul></ul>");
        	$lista = $page.find(".content ul");
			var premiumCounter = 0;
			var baseCounter = 0;
			var juniorCounter = 0;
			var strPremiunHtml = '<li data-role="list-divider"> Premium </li>';
			var strBaseHtml = '<li data-role="list-divider"> Base </li>';
			var strJuniorHtml = '<li data-role="list-divider"> Junior </li>';
			var strHtml = "";
			
			$.each(data, function(key, val) {
				strHtml = '<li data-icon="false"><a href="http://' + val.SponsorLink + '" target="_blank">' + ((val.imagen != "" && val.imagen)? '<img src="' + val.imagen + '">' : "") + '<h3> ' + val.SponsorNombre + ' </h3> ' + val.SponsorDescripcion + ' </a></li>';
				switch(val.SponsorTipo){
					case "PMN":
						premiumCounter++;
						strPremiunHtml += strHtml;
						break;
					case "BAS":
						baseCounter++;
						strBaseHtml += strHtml;
						break;
					case "JUN":
						juniorCounter++;
						strJuniorHtml += strHtml;
						break;
				}
			});
				
			var item;
			if(premiumCounter > 0){
				item = $(strPremiunHtml);
				$lista.append(item);
			}
			if(baseCounter > 0){
				item = $(strBaseHtml);
				$lista.append(item);
			}
			if(juniorCounter > 0){
				item = $(strJuniorHtml);
				$lista.append(item);
			}
			
			$lista.listview();
        }
		
		function traerAgenda(){
			$.ajax({
				url: 'http://buhoonline.com/ex2012/servlet/awsagenda',
				type: "POST",
				datatype: 'xml',
				data: soapMessageC,
				complete: guardarAgenda,
				failure: onAgendaError
			});
    	}

		function onAgendaError(){
    		var data = window.localStorage.getItem('agenda');
    		if(data != null)
    			llenarAgenda($.parseJSON(data));
    		else{
    			$.getJSON("json/agenda.json", 
    				function(data){
						llenarAgenda(data)
					}
				);
			}
    	}
		
		function guardarAgenda(data){
			var agenda = $(data.responseText).text();
			window.localStorage.setItem('agenda', agenda);
        	llenarAgenda($.parseJSON(agenda));
		}
		
		//Llena la lista de charlas a traves de un json como parametro
		function llenarAgenda(data){
        	var $page = $("#Agenda");
        	
        	$page.find(".content").empty();
        	
        	$page.find(".content").html("<ul></ul>");
        	
        	$lista = $page.find(".content ul");
        	$lista.attr("data-filter","true");
			$lista.attr("data-role","listview");
			$lista.attr("id","testlist" );
        	var items = [];
			$.each(data, function(key, val) {
				var strHtml = '<li data-role="list-divider"> ' + key + ' </li>';
				var item = $(strHtml);
				$lista.append(item);
				$.each(val, function(key, val) {
					strHtml = '<li data-filtertext='+val.grupo+'><a href="#detalleCharla"><p><strong>'+val.grupo+'</strong></p><h1><strong>'+val.titulo+'</strong></h1><p>'+val.descripcion+'</p></a></li>'; 
					var item = $(strHtml);
					$lista.append(item);
					$lista.find("a:last").jqmData("agenda",JSON.stringify(val));
				});
			});
			$lista.listview();
			$lista.find('a').click(function(){
				var $this = $(this);
				$("#detalleCharla").jqmData("agenda",$this.jqmData("agenda"));
			});
        }

		function traerSpeakers(){
			$.ajax({
				url: 'http://buhoonline.com/ex2012/servlet/awsspeakers',
				type: "POST",
				datatype: 'xml',
				data: soapMessageC,
				complete: guardarSpeakers,
				failure: onSpeakersError
			});
    	}

		function onSpeakersError(){
    		var data = window.localStorage.getItem('speakers');
    		if(data != null)
    			llenarSpeakers($.parseJSON(data));
    		else{
    			$.getJSON("json/speakers.json", 
    				function(data){
						llenarSpeakers(data)
					}
				);
			}
    	}
		
		function guardarSpeakers(data){
			var speakers = $(data.responseText).text();
			window.localStorage.setItem('speakers', speakers);
        	llenarSpeakers($.parseJSON(speakers));
		}
    	
    	//Llena la lista de speakers a traves de un json como parametro
        function llenarSpeakers(data){
        	var $page = $("#speakers");
        	$page.find(".content").empty();
        	$page.find(".content").html("<ul></ul>");
        	$lista = $page.find(".content ul");
			$lista.attr("data-autodividers", "true");
			$.each(data, function(key, val) {
				strHtml = '<li><a href="#detalleSpeaker">' + ((val.imagen != "" && val.imagen)? '<img src="'+val.imagen+'"/>' : "") + '<h1><strong>'+val.SpeakerNombre+'</strong></h1><p>'+val.SpeakerAbstract+'</p></a></li>';
				$lista.append($(strHtml));
				$lista.find("a:last").jqmData("speaker",JSON.stringify(val));
			});
			$lista.listview();
			$lista.find('a').click(
				function(){
					var $this = $(this);
					$("#detalleSpeaker").jqmData("speaker",$this.jqmData("speaker"));
				}
			);
        }
    
        $(function() {
        	$('#Sponsors').live("pagebeforeshow", function(){
        		if(localStorage.getItem("resumeSponsors") == "1"){
 		       		traerSponsors();
 		       		localStorage.setItem("resumeSponsors", "0");
 		       	}
        	});	

			$('#Agenda').live("pagebeforeshow", function(){
        		if(localStorage.getItem("resumeAgenda") == "1"){
					traerAgenda();
 		       		localStorage.setItem("resumeAgenda", "0");
 		       	}
        	});
        	
        	$('#speakers').live("pagebeforeshow", function(){
        		if(localStorage.getItem("resumeSpeakers") == "1"){
 		       		traerSpeakers();
 		       		localStorage.setItem("resumeSpeakers", "0");
 		       	}
        	});

			$('#Donde').live("pageinit", function() {
				var yourStartLatLng = '57.7973333,12.0502107';

				$('#map_canvas').gmap({'center': yourStartLatLng});

				$('#map_canvas').gmap().bind('init', function(ev, map) {
					$('#map_canvas').gmap('option', 'zoom', 18);
					$('#map_canvas').gmap('addMarker', {'position': '57.7975333,12.0502107'}).click(function() {
						$('#map_canvas').gmap('openInfoWindow', {'content': 'Hello World!'}, this);
					});
				});
				$('#map_canvas').gmap('refresh');
			});
	    });
        
        

		

		
      
		//Llena llena los tweets
       	$(document).ready(function(){
       	
       		$('#Tweets').live(
       			"pagebeforeshow",
       			function() {
					$('#tweetFeed').jTweetsAnywhere({
						searchParams: 'q=Endeavor_Noa',
						count: 20,
						showTweetFeed: {
							showProfileImages: true,
							showUserScreenNames: true,
							showUserFullNames: true,
							showActionReply: true,
							showActionRetweet: true,
							showActionFavorite: true,
							paging: {
								mode: "more"
							}
						},
						showTweetBox: false,
					});
					$('.jta-tweet-list-controls').find("span").html("M&aacute;s Tweets");
//					$(".jta-tweet-list-controls-button jta-tweet-list-controls-button-more").val("MÃ¡s Tweets");
			});
			
			$('#Tweets').live(
       			"pagehide",
       			function() {
					$('#tweetFeed').empty();
			});
			
			//Llena el tab agenda con el div #Agenda que esta dentro del archivo #XE2012
			var clicked1 = "false";
			
			$("#filterBar").delegate("a", "click", function () {
				if ($(this).text().toString() != "Todos"){
					$("div.ui-input-search").find("input").val($(this).text());
					$("div.ui-input-search").find("input").keyup();
				}
				else{
					$("div.ui-input-search").find("input").val("");
					$("div.ui-input-search").find("input").keyup();
				}
			});
	
			
			$('#detalleCharla').live(
				"pagehide", 
				function() {
					var $page = $('#detalleCharla');
					$page.find("div[data-role='header'] h1").empty();
					$page.find(".content").empty();
				}
			);
			
			//al mostrar la pagina detalleCharla
			$('#detalleCharla').live(
				"pageshow", 
				function() {
					var $page = $('#detalleCharla');
					var data = $.parseJSON($page.jqmData("agenda"));
					$page.find("div[data-role='header'] h1").remove();
					$page.find("div[data-role='header']").append('<h1 class="ui-title" role="heading" aria-level="1">' + data.titulo + '</h1>');
					$page.find(".content").empty();
					$page.find(".content").html("<h4>"+data.descripcion+"</h4><p>"+data.contenido+"</p>");
					if(data.speakers){
						$page.find(".content").append($("<ul></ul>"));
						$lista=$page.find(".content ul");
						$lista.append($('<li data-role="list-divider"> SPEAKERS </li>'));		
						$.each(data.speakers, function(key, val){
							strHtml = '<li><a href="#detalleSpeaker"><img src="'+val.imagen+'"/><h1><strong>'+val.nombre+'</strong></h1><p>'+val.puesto+'</p></a></li>';
							$lista.append($(strHtml));
							$lista.find("a:last").jqmData("speaker",JSON.stringify(val));
						});
						$lista.listview();
						$lista.find('a').click(
							function(){
								var $this = $(this);
								$("#detalleSpeaker").jqmData("speaker",$this.jqmData("speaker"));
							}
						);
					}
				}
			);
			
			$('#detalleSpeaker').live(
				"pagehide", 
				function() {
					var $page = $('#detalleSpeaker');
					$page.find("div[data-role='header'] h1").empty();
					$page.find(".content").empty();
				}
			);
			
			//al mostrar la pagina detalleSpeaker
			$('#detalleSpeaker').live(
				"pageshow", 
				function() {
					var $page = $('#detalleSpeaker');
					var data = $.parseJSON($page.jqmData("speaker"));
					$page.find("div[data-role='header'] h1").remove();
					$page.find("div[data-role='header']").append('<h1 class="ui-title" role="heading" aria-level="1">SPEAKER</h1>');
					$page.find(".content").empty();
					strHtml = '<div style="display:block;padding:1em .8em;margin:0"><div style="float:left;margin-right:10px;">' + ((data.imagen != "" && data.imagen)? '<img src="'+data.imagen+'"/>' : "") + '</div><div style="background-image:-webkit-linear-gradient(top,white,#FBFBFB 3%,#E1E1E1);padding:0.5em"><h4>'+data.SpeakerNombre+'</h4><p>'+data.SpeakerAbstract+'</p></div></div><div style="padding:1em 0.8em;clear:both"><p>Biografia del speaker</p><p>'+data.SpeakerCurriculum+'</p></div>';
					$page.find(".content").append(strHtml);
					
				}
			);
        });
		
    </script>

    <style type="text/css">
        .details-page {
            width: 100%;
            height: 80%;
        }
        #map_content {
            padding: 0px;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #map_canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            text-shadow: none;
        }
    </style>
    
</head>
<body onload="onLoad()">
    <div data-role="page" id="XE2012">
        <div data-role="header" data-id="headerBar" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012" class="ui-btn-active ui-state-persist">XE2012</a></li>
                    <li><a href="#Agenda">Agenda</a></li>
                    <li><a href="#Tweets">Tweets</a></li>
                    <li><a href="#speakers">Speakers</a></li>
                </ul>
            </div>
            
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012" class="ui-btn-active ui-state-persist"  data-theme="c">Que</a></li>
                    <li><a href="#Donde" data-theme="c">Donde</a></li>
                    <li><a href="#Sponsors" data-theme="c">Sponsors</a></li>
                </ul>
            </div>
            
        </div>
        <div data-role="content">
            <p>Que content</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum posuere sollicitudin nunc. Ut rutrum tempor bibendum. In in nibh tellus, at imperdiet elit. Phasellus pretium, quam sit amet pretium rhoncus, justo eros luctus erat, nec sagittis tortor velit at metus. Cras vitae orci augue, at adipiscing diam. Phasellus accumsan placerat nulla, in facilisis odio commodo sed. Pellentesque porta turpis sit amet mauris laoreet ut placerat urna adipiscing. Morbi diam turpis, accumsan eget dignissim et, blandit non ligula. Curabitur laoreet suscipit arcu non porttitor. Aliquam quis lacinia tortor.

Curabitur pulvinar nibh id elit dictum feugiat. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Suspendisse faucibus auctor massa et suscipit. Aliquam id pulvinar ligula. Vestibulum rutrum, dui quis rhoncus euismod, ligula eros pretium est, non placerat felis diam id mi. Fusce ac eros risus. Sed vestibulum leo risus.

Morbi sit amet orci mi, eget cursus quam. In hac habitasse platea dictumst. Ut imperdiet consectetur est, vel porttitor nisl congue quis. Vivamus ut enim arcu, eget lacinia purus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Suspendisse commodo quam et orci rutrum congue. Curabitur condimentum feugiat enim, quis auctor velit adipiscing eget. Sed mattis ornare consequat.

Proin blandit dui ac lacus iaculis eget semper quam sagittis. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Etiam ut justo a purus semper tempor. Etiam a molestie orci. Ut posuere tristique leo, non varius eros mattis at. Maecenas justo sapien, rutrum nec ultrices at, luctus a quam. Aenean vehicula semper gravida. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Aenean eget sem magna, id mollis nulla. Sed sodales elementum arcu, id hendrerit magna ullamcorper ac. In bibendum commodo auctor. Sed libero quam, commodo vitae sodales id, tempor sit amet nulla. Vivamus nisi mi, lacinia a consequat ac, aliquam eu elit. Proin pharetra justo id libero pellentesque aliquet vitae et eros. Quisque sed nisl in enim rhoncus cursus.

Maecenas egestas congue lacus eu aliquet. Ut lobortis adipiscing euismod. Fusce in orci a justo facilisis consectetur in id odio. Nulla a ultricies massa. Proin id est a lacus rhoncus cursus et et mi. Sed cursus, eros vitae venenatis adipiscing, nibh dui adipiscing magna, non vulputate dui lacus ac arcu. Mauris ac ipsum ac magna sollicitudin rutrum eget vitae dui.</p>
        </div>
    </div>
    
    <!-- DONDE -->
    <div data-role="page" id="Donde" class="details-page">
        <div data-role="header" data-id="headerBar" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012" class="ui-btn-active ui-state-persist">XE2012</a></li>
                    <li><a href="#Agenda">Agenda</a></li>
                    <li><a href="#Tweets">Tweets</a></li>
                    <li><a href="#speakers">Speakers</a></li>
                </ul>
            </div>
            
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012" data-theme="c">Que</a></li>
                    <li><a href="#Donde" class="ui-btn-active ui-state-persist" data-theme="c">Donde</a></li>
                    <li><a href="#Sponsors" data-theme="c">Sponsors</a></li>
                </ul>
            </div>
        </div>
        <div data-role="content" id="map_content">
            <p>Donde content</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum posuere sollicitudin nunc. Ut rutrum tempor bibendum. In in nibh tellus, at imperdiet elit. Phasellus pretium, quam sit amet pretium rhoncus, justo eros luctus erat, nec sagittis tortor velit at metus.</p>
            <!-- Here it should be a google map -->
            <!--<div id="map_canvas" style="width:250px;height:250px"></div>-->
            <div id="map_content">
                <div id="map_canvas"></div>
            </div>
        </div>
    </div>
    
    <!-- Sponsors -->
    <div data-role="page" id="Sponsors">
        <div data-role="header" data-id="headerBar" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012" class="ui-btn-active ui-state-persist">XE2012</a></li>
                    <li><a href="#Agenda">Agenda</a></li>
                    <li><a href="#Tweets">Tweets</a></li>
                    <li><a href="#speakers">Speakers</a></li>
                </ul>
            </div>
            
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012" data-theme="c">Que</a></li>
                    <li><a href="#Donde" data-theme="c">Donde</a></li>
                    <li><a href="#Sponsors" class="ui-btn-active ui-state-persist" data-theme="c">Sponsors</a></li>
                </ul>
            </div>
        </div>
        <div data-role="content" class="content">
        </div>
    </div>
    
    <!-- Tweets -->
    <div data-role="page" id="Tweets">
        <div data-role="header" data-id="headerBar" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012">XE2012</a></li>
                    <li><a href="#Agenda">Agenda</a></li>
                    <li><a href="#Tweets" class="ui-btn-active ui-state-persist">Tweets</a></li>
                    <li><a href="#speakers">Speakers</a></li>
                </ul>
            </div>
        </div>
		<div data-role="content">
			<p>Tweets</p>
			<div id="tweetFeed">
			</div>
		</div>
	</div>
	<!-- Agenda-->
	<div data-role="page" id="Agenda">
        <div data-role="header" data-id="headerBar" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012">XE2012</a></li>
                    <li><a href="#Agenda" class="ui-btn-active ui-state-persist">Agenda</a></li>
                    <li><a href="#Tweets">Tweets</a></li>
                    <li><a href="#speakers">Speakers</a></li>
                </ul>
            </div>
            
            <div data-role="navbar" id="filterBar">
                <ul>
                    <li><a href="" data-theme="c" class="ui-btn-active ui-state-persist">Todos</a></li>
                    <li><a href="" data-theme="c">Academia</a></li>
                    <li><a href="" data-theme="c">Talks</a></li>
                    <li><a href="" data-theme="c">Networking</a></li>
                </ul>
            </div>
        </div>
        
        <div data-role="content" class="content">
		</div>
      
    </div>

	<!--Detalle charla-->
	<div data-role="page" id="detalleCharla">
        <div data-role="header" data-id="headerBar" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012">XE2012</a></li>
                    <li><a href="#Agenda" class="ui-btn-active ui-state-persist">Agenda</a></li>
                    <li><a href="#Tweets">Tweets</a></li>
                    <li><a href="#speakers">Speakers</a></li>
                </ul>
            </div>
			<h1></h1>
        </div>
        
        <div data-role="content" class="content">
            
            
        </div>
        
        <div data-role="footer" data-position="fixed">
            <a data-rel="back">Volver</a>
        </div>
    </div>

	<!--Detalle Sepeaker-->
	<div data-role="page" id="detalleSpeaker">
        <div data-role="header" data-id="headerBar" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012">XE2012</a></li>
                    <li><a href="#Agenda">Agenda</a></li>
                    <li><a href="#Tweets">Tweets</a></li>
                    <li><a href="#speakers" class="ui-btn-active ui-state-persist">Speakers</a></li>
                </ul>
            </div>
            <h1></h1>
        </div>
        
        <div data-role="content" class="content">
            
        </div>
        
        <div data-role="footer" data-position="fixed">
            <a data-rel="back">Volver</a>
        </div>
    </div>

	<!--Detalle Sepeaker-->
	
	<div data-role="page" id="speakers">
        <div data-role="header" data-id="headerBar" data-position="fixed" data-theme="a">
            <div data-role="navbar">
                <ul>
                    <li><a href="#XE2012">XE2012</a></li>
                    <li><a href="#Agenda">Agenda</a></li>
                    <li><a href="#Tweets">Tweets</a></li>
                    <li><a href="#speakers" class="ui-btn-active ui-state-persist">Speakers</a></li>
                </ul>
            </div>
        </div>
    <div data-role="content" class="content">
        
    </div>
	
</body>
</html>